#!/usr/bin/env ruby

# Creates a webserver on port 8888 for the current dir (or optionally, the directory passed on the commandline)

require 'rack'

root = ARGV.first || Dir.pwd

directory_viewer = proc do |env|
  req = Rack::Request.new(env)

  # Show "index.html" if it exists
  req.path_info += "index.html" if File.exists?(File.join(root, req.path_info, "index.html"))

  # Serve the file or directory
  Rack::Directory.new(root).call(env)
end

puts
puts "* Serving files in: #{root}"
puts "                on: http://localhost:8888/"
puts

server = Rack::Handler.pick ['thin', 'webrick']
server.run directory_viewer, Port: 8888